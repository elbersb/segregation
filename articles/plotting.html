<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualizing segregation • segregation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualizing segregation">
<meta property="og:description" content="segregation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">segregation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/segregation.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Visualizing segregation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/elbersb/segregation/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visualizing segregation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/elbersb/segregation/blob/HEAD/vignettes/plotting.Rmd" class="external-link"><code>vignettes/plotting.Rmd</code></a></small>
      <div class="hidden name"><code>plotting.Rmd</code></div>

    </div>

    
    
<p>The package provides the functions <code><a href="../reference/segcurve.html">segcurve()</a></code> and <code><a href="../reference/segplot.html">segplot()</a></code> to visualize segregation. These functions return simple ggplots, which can then be further styled and themed. For the <code><a href="../reference/segplot.html">segplot()</a></code> function, it is often interesting to also compress the segregation information that is contained in large datasets. How to do this using the functions <code><a href="../reference/compress.html">compress()</a></code> and <code><a href="../reference/merge_units.html">merge_units()</a></code> is also described below, and in more detail <a href="https://osf.io/preprints/socarxiv/ruw4g/" class="external-link">in this working paper</a>.</p>
<div class="section level2">
<h2 id="segregation-curve">Segregation curve<a class="anchor" aria-label="anchor" href="#segregation-curve"></a>
</h2>
<p>The segregation curve was first introduced by <a href="https://www.jstor.org/stable/2088328" class="external-link">Duncan and Duncan (1955)</a>. The function <code><a href="../reference/segcurve.html">segcurve()</a></code> provides a simple way of plotting a segregation curve:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/segcurve.html">segcurve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">schools00</span>, <span class="va">race</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="st">"race"</span>, <span class="st">"school"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="segplot">Segplot<a class="anchor" aria-label="anchor" href="#segplot"></a>
</h2>
<p>The function <code><a href="../reference/segplot.html">segplot()</a></code> is provided to generate segplots. Segplots are described in more detail <a href="https://osf.io/preprints/socarxiv/ruw4g/" class="external-link">in this working paper</a>. The function requires the dataset, the group, and unit variables, and, if required, a variable that identifies the weight (<code>n</code> in this case).</p>
<p>Other options to customize the look of the segplot are given by the argument <code>order</code>. By default, the units of the segplot are ordered by their local segregation score, but it is also possible to order them by entropy (i.e., diversity) or by share of the majority population. This last option can be useful for the two-group case. The argument <code>bar_space</code> can be used to increase the space between the units from the default of zero space between bars. When plotting a subset of the dataset, the reference distribution shown on the right of the segplot can be changed by supplying a two-column data frame to the <code>reference_distribution</code> argument. One column of this frame should contain the group identifiers, and the other should include the reference proportion of each group. To show axis labels either on the left side only, the right side only, or on both sides, use the argument <code>axis_labels</code>.</p>
<p>Examples of how to use these arguments are given below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">schools00</span>, <span class="va">state</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># basic segplot</span></span>
<span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span>, axis_labels <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># order by majority group (white in this case)</span></span>
<span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span>, order <span class="op">=</span> <span class="st">"majority"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># increase the space between bars</span></span>
<span><span class="co"># (has to be very low here because there are many schools in this dataset)</span></span>
<span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span>, bar_space <span class="op">=</span> <span class="fl">0.0005</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-3.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change the reference distribution</span></span>
<span><span class="co"># (here, we just use an equalized distribution across the five groups)</span></span>
<span><span class="op">(</span><span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">schools00</span><span class="op">$</span><span class="va">race</span><span class="op">)</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     race   p</span></span>
<span><span class="co">## 1  asian 0.2</span></span>
<span><span class="co">## 2  black 0.2</span></span>
<span><span class="co">## 3   hisp 0.2</span></span>
<span><span class="co">## 4  white 0.2</span></span>
<span><span class="co">## 5 native 0.2</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  reference_distribution <span class="op">=</span> <span class="va">ref</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-4.png" width="700"></p>
<div class="section level3">
<h3 id="compressing-segregation-information">Compressing segregation information<a class="anchor" aria-label="anchor" href="#compressing-segregation-information"></a>
</h3>
<p>The compression algorithm requires three steps to be taken. First, it is important to decide which units should be permitted to merge: for residential segregation, we may only want to allow neighboring units (such as tracts) to be mergeable. In this case, the first step consists of compiling a data frame with exactly two columns, where each row identifies a pair of neighboring units. In other cases, we may want to allow all units to be mergeable, in principle. However, this can be very time-consuming as it requires each unit to be compared to all others at every step of the merging operation. To speed up compression, we therefore implement an option that allows units to be merged only within a window of “neighboring” units, where the definition of each window is based on similarities in local segregation. Hence, for a given unit, only <code>n_neighbors</code> are considered at every step, and these neighbors are based on similarities in local segregation. Smaller <code>n_neighbors</code> values will result in faster run times, but increase the probability of non-optimal merges. The method of merging can be specified in the <code><a href="../reference/compress.html">compress()</a></code> function by supplying the argument neighbors.</p>
<p>The second step is then to run the actual compression algorithm using <code><a href="../reference/compress.html">compress()</a></code>. For this example, we choose to compress based on a relatively small window:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compression based on window of 20 'neighboring' units</span></span>
<span><span class="co"># in terms of local segregation (alternatively, neighbors can be a data frame)</span></span>
<span><span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compress.html">compress</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"n"</span>, neighbors <span class="op">=</span> <span class="st">"local"</span>, n_neighbors <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After running <code><a href="../reference/compress.html">compress()</a></code>—which can take some time depending on how many neighbors need to be considered—the output summarizes the compression that can be achieved:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp</span></span></code></pre></div>
<pre><code><span><span class="co">## Compression of dataset with 560 units</span></span>
<span><span class="co">## Original M: 0.4085965; Final M: 0</span></span>
<span><span class="co">## - Threshold 99%: M = 0.4045489; Units = 98</span></span>
<span><span class="co">## - Threshold 95%: M = 0.3886079; Units = 24</span></span>
<span><span class="co">## - Threshold 90%: M = 0.3696806; Units = 10</span></span></code></pre>
<p>The results indicate that 99% of the segregation information can be retained by only 98 units (out of 560 in the original dataset), 95% in only 24 units, and 90% in 10 units. The percentage of information retained on each iteration can be accessed via the data frame available through <code>comp$iterations</code>. This data frame can also be used to generate a plot that shows the relationship between the number of merges and the loss in segregation information:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scree_plot.html">scree_plot</a></span><span class="op">(</span><span class="va">comp</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>The third step is to create a new dataset based on the desired level of compression. This can be achieved using the function <code><a href="../reference/merge_units.html">merge_units()</a></code>, and either <code>n_units</code> or <code>percent</code> can be specified to indicate the desired level of compression.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch_compressed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_units.html">merge_units</a></span><span class="op">(</span><span class="va">comp</span>, n_units <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co"># or, for instance: merge_units(comp, percent = 0.80)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sch_compressed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    school   race     n</span></span>
<span><span class="co">## 1:    M14  asian   394</span></span>
<span><span class="co">## 2:    M14  black  5742</span></span>
<span><span class="co">## 3:    M14   hisp   880</span></span>
<span><span class="co">## 4:    M14  white 31256</span></span>
<span><span class="co">## 5:    M14 native   218</span></span>
<span><span class="co">## 6:    M15  asian     2</span></span></code></pre>
<p>The compressed dataset has the same format as the original dataset and can now be used to produce another segplot, e.g.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch_compressed</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Benjamin Elbers.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
