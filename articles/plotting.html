<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="segregation">
<title>Visualizing and compressing segregation • segregation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visualizing and compressing segregation">
<meta property="og:description" content="segregation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">segregation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/segregation.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
    <a class="dropdown-item" href="../articles/plotting.html">Visualizing and compressing segregation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/elbersb/segregation/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Visualizing and compressing segregation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/elbersb/segregation/blob/HEAD/vignettes/plotting.Rmd" class="external-link"><code>vignettes/plotting.Rmd</code></a></small>
      <div class="d-none name"><code>plotting.Rmd</code></div>
    </div>

    
    
<p>The package provides the functions <code><a href="../reference/segcurve.html">segcurve()</a></code> and
<code><a href="../reference/segplot.html">segplot()</a></code> to visualize segregation. These functions return
simple ggplots, which can then be further styled and themed. For the
<code><a href="../reference/segplot.html">segplot()</a></code> function, it is often interesting to also
compress the segregation information that is contained in large
datasets. How to do this using the functions <code><a href="../reference/compress.html">compress()</a></code> and
<code><a href="../reference/merge_units.html">merge_units()</a></code> is also described below, and in more detail
<a href="https://osf.io/preprints/socarxiv/ruw4g/" class="external-link">in this working
paper</a>.</p>
<div class="section level2">
<h2 id="segregation-curve">Segregation curve<a class="anchor" aria-label="anchor" href="#segregation-curve"></a>
</h2>
<p>The segregation curve was first introduced by <a href="https://www.jstor.org/stable/2088328" class="external-link">Duncan and Duncan
(1955)</a>. The function <code><a href="../reference/segcurve.html">segcurve()</a></code> provides a simple way
of plotting a segregation curve:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/segcurve.html">segcurve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">schools00</span>, <span class="va">race</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="st">"race"</span>, <span class="st">"school"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="segplot">Segplot<a class="anchor" aria-label="anchor" href="#segplot"></a>
</h2>
<p>The function <code><a href="../reference/segplot.html">segplot()</a></code> is provided to generate segplots.
Segplots are described in more detail <a href="https://osf.io/preprints/socarxiv/ruw4g/" class="external-link">in this working
paper</a>. The function requires the dataset, the group, and unit
variables, and, if required, a variable that identifies the weight
(<code>n</code> in this case).</p>
<p>Other options to customize the look of the segplot are given by the
argument <code>order</code>. By default, the units of the segplot are
ordered by their local segregation score, but it is also possible to
order them by entropy (i.e., diversity) or by share of the majority
population. This last option can be useful for the two-group case. The
argument <code>bar_space</code> can be used to increase the space
between the units from the default of zero space between bars. When
plotting a subset of the dataset, the reference distribution shown on
the right of the segplot can be changed by supplying a two-column data
frame to the <code>reference_distribution</code> argument. One column of
this frame should contain the group identifiers, and the other should
include the reference proportion of each group. To show axis labels
either on the left side only, the right side only, or on both sides, use
the argument <code>axis_labels</code>.</p>
<p>Examples of how to use these arguments are given below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">schools00</span>, <span class="va">state</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># basic segplot</span></span>
<span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span>, axis_labels <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># order by majority group (white in this case)</span></span>
<span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span>, order <span class="op">=</span> <span class="st">"majority"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># increase the space between bars</span></span>
<span><span class="co"># (has to be very low here because there are many schools in this dataset)</span></span>
<span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span>, bar_space <span class="op">=</span> <span class="fl">0.0005</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-3.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># change the reference distribution</span></span>
<span><span class="co"># (here, we just use an equalized distribution across the five groups)</span></span>
<span><span class="op">(</span><span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">schools00</span><span class="op">$</span><span class="va">race</span><span class="op">)</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     race   p</span></span>
<span><span class="co">#&gt; 1  asian 0.2</span></span>
<span><span class="co">#&gt; 2  black 0.2</span></span>
<span><span class="co">#&gt; 3   hisp 0.2</span></span>
<span><span class="co">#&gt; 4  white 0.2</span></span>
<span><span class="co">#&gt; 5 native 0.2</span></span>
<span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  reference_distribution <span class="op">=</span> <span class="va">ref</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-3-4.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="compressing-segregation-information">Compressing segregation information<a class="anchor" aria-label="anchor" href="#compressing-segregation-information"></a>
</h2>
<p>The compression algorithm requires three steps to be taken. First, it
is important to decide which units should be permitted to merge: for
residential segregation, we may only want to allow neighboring units
(such as tracts) to be mergeable. In this case, the first step consists
of compiling a data frame with exactly two columns, where each row
identifies a pair of neighboring units. In other cases, we may want to
allow all units to be mergeable, in principle. However, this can be very
time-consuming as it requires each unit to be compared to all others at
every step of the merging operation. To speed up compression, we
therefore implement an option that allows units to be merged only within
a window of “neighboring” units, where the definition of each window is
based on similarities in local segregation. Hence, for a given unit,
only <code>n_neighbors</code> are considered at every step, and these
neighbors are based on similarities in local segregation. Smaller
<code>n_neighbors</code> values will result in faster run times, but
increase the probability of non-optimal merges. The method of merging
can be specified in the <code><a href="../reference/compress.html">compress()</a></code> function by supplying
the argument neighbors.</p>
<p>The second step is then to run the actual compression algorithm using
<code><a href="../reference/compress.html">compress()</a></code>. For this example, we choose to compress based
on a relatively small window:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compression based on window of 20 'neighboring' units</span></span>
<span><span class="co"># in terms of local segregation (alternatively, neighbors can be a data frame)</span></span>
<span><span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compress.html">compress</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"race"</span>, <span class="st">"school"</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"n"</span>, neighbors <span class="op">=</span> <span class="st">"local"</span>, n_neighbors <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After running <code><a href="../reference/compress.html">compress()</a></code>—which can take some time
depending on how many neighbors need to be considered—the output
summarizes the compression that can be achieved:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp</span></span>
<span><span class="co">#&gt; Compression of dataset with 560 units</span></span>
<span><span class="co">#&gt; Original M: 0.4085965; Final M: 0</span></span>
<span><span class="co">#&gt; - Threshold 99%: M = 0.4045242; Units = 92</span></span>
<span><span class="co">#&gt; - Threshold 95%: M = 0.388871; Units = 22</span></span>
<span><span class="co">#&gt; - Threshold 90%: M = 0.3695035; Units = 9</span></span></code></pre></div>
<p>The results indicate that 99% of the segregation information can be
retained by only 98 units (out of 560 in the original dataset), 95% in
only 24 units, and 90% in 10 units. The percentage of information
retained on each iteration can be accessed via the data frame available
through <code>comp$iterations</code>. This data frame can also be used
to generate a plot that shows the relationship between the number of
merges and the loss in segregation information:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/scree_plot.html">scree_plot</a></span><span class="op">(</span><span class="va">comp</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Another way to learn more about the compression is to visualize the
information as a dendrogram:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">comp</span><span class="op">)</span></span>
<span><span class="fu">dendextend</span><span class="fu">::</span><span class="fu">labels</span><span class="op">(</span><span class="va">dend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># remove the labels</span></span>
<span><span class="co">#&gt; Warning in `labels&lt;-.dendrogram`(`*tmp*`, value = NULL): The lengths of the new</span></span>
<span><span class="co">#&gt; labels is shorter than the number of leaves in the dendrogram - labels are</span></span>
<span><span class="co">#&gt; recycled.</span></span>
<span><span class="co">#&gt; Warning in rep(new_labels, length.out = leaves_length): 'x' is NULL so the</span></span>
<span><span class="co">#&gt; result will be NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dend</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The third step is to create a new dataset based on the desired level
of compression. This can be achieved using the function
<code><a href="../reference/merge_units.html">merge_units()</a></code>, and either <code>n_units</code> or
<code>percent</code> can be specified to indicate the desired level of
compression.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch_compressed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_units.html">merge_units</a></span><span class="op">(</span><span class="va">comp</span>, n_units <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co"># or, for instance: merge_units(comp, percent = 0.80)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sch_compressed</span><span class="op">)</span></span>
<span><span class="co">#&gt;    school  race    n</span></span>
<span><span class="co">#&gt; 1:    M12 asian  143</span></span>
<span><span class="co">#&gt; 2:    M12 black  445</span></span>
<span><span class="co">#&gt; 3:    M12  hisp  472</span></span>
<span><span class="co">#&gt; 4:    M12 white 6174</span></span>
<span><span class="co">#&gt; 5:     M2 black   67</span></span>
<span><span class="co">#&gt; 6:     M2  hisp  642</span></span></code></pre></div>
<p>The compressed dataset has the same format as the original dataset
and can now be used to produce another segplot, e.g.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/segplot.html">segplot</a></span><span class="op">(</span><span class="va">sch_compressed</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://elbersb.com" class="external-link">Benjamin Elbers</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
