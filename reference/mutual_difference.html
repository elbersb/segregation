<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Decomposes the difference between two M indices — mutual_difference • segregation</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Decomposes the difference between two M indices — mutual_difference" />
<meta property="og:description" content="Uses one of three methods to decompose the difference between two M indices:
(1) &quot;shapley&quot; / &quot;shapley_detailed&quot;: a method based on the Shapley decomposition
with a few advantages over the Karmel-Maclachlan method
(recommended and the default, Deutsch et al. 2006),
(2) &quot;km&quot;: the method based on Karmel-Maclachlan (1988),
(3) &quot;mrc&quot;: the method developed by Mora and Ruiz-Castillo (2009).
All methods have been extended to account for missing units/groups in either data input." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">segregation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/segregation.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/elbersb/segregation/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Decomposes the difference between two M indices</h1>
    <small class="dont-index">Source: <a href='https://github.com/elbersb/segregation/blob/master/R/mutual_difference.R'><code>R/mutual_difference.R</code></a></small>
    <div class="hidden name"><code>mutual_difference.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Uses one of three methods to decompose the difference between two M indices:
(1) "shapley" / "shapley_detailed": a method based on the Shapley decomposition
with a few advantages over the Karmel-Maclachlan method
(recommended and the default, Deutsch et al. 2006),
(2) "km": the method based on Karmel-Maclachlan (1988),
(3) "mrc": the method developed by Mora and Ruiz-Castillo (2009).
All methods have been extended to account for missing units/groups in either data input.</p>
    </div>

    <pre class="usage"><span class='fu'>mutual_difference</span><span class='op'>(</span>
  <span class='va'>data1</span>,
  <span class='va'>data2</span>,
  <span class='va'>group</span>,
  <span class='va'>unit</span>,
  weight <span class='op'>=</span> <span class='cn'>NULL</span>,
  method <span class='op'>=</span> <span class='st'>"shapley"</span>,
  se <span class='op'>=</span> <span class='cn'>FALSE</span>,
  CI <span class='op'>=</span> <span class='fl'>0.95</span>,
  n_bootstrap <span class='op'>=</span> <span class='fl'>100</span>,
  base <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data1</th>
      <td><p>A data frame with same structure as <code>data2</code>.</p></td>
    </tr>
    <tr>
      <th>data2</th>
      <td><p>A data frame with same structure as <code>data1</code>.</p></td>
    </tr>
    <tr>
      <th>group</th>
      <td><p>A categorical variable or a vector of variables
contained in <code>data</code>. Defines the first dimension
over which segregation is computed.</p></td>
    </tr>
    <tr>
      <th>unit</th>
      <td><p>A categorical variable or a vector of variables
contained in <code>data</code>. Defines the second dimension
over which segregation is computed.</p></td>
    </tr>
    <tr>
      <th>weight</th>
      <td><p>Numeric. (Default <code>NULL</code>)</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Either "shapley" (the default), "km" (Karmel and Maclachlan method), or
"mrc" (Mora and Ruiz-Castillo method).</p></td>
    </tr>
    <tr>
      <th>se</th>
      <td><p>If <code>TRUE</code>, the segregation estimates are bootstrapped to provide
standard errors and to apply bias correction. The bias that is reported
has already been applied to the estimates (i.e. the reported estimates are "debiased")
(Default <code>FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>CI</th>
      <td><p>If <code>se = TRUE</code>, compute the confidence (CI*100)<!-- % confidence interval -->
in addition to the bootstrap standard error.
This is based on percentiles of the bootstrap distribution, and a valid interpretation
relies on a larger number of bootstrap iterations. (Default <code>0.95</code>)</p></td>
    </tr>
    <tr>
      <th>n_bootstrap</th>
      <td><p>Number of bootstrap iterations. (Default <code>100</code>)</p></td>
    </tr>
    <tr>
      <th>base</th>
      <td><p>Base of the logarithm that is used in the calculation.
Defaults to the natural logarithm.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Only used for additional arguments when
when <code>method</code> is set to <code>shapley</code> or <code>km</code>. See <a href='ipf.html'>ipf</a> for details.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a data.table with columns <code>stat</code> and <code>est</code>. The data frame contains
  the following rows defined by <code>stat</code>:
  <code>M1</code> contains the M for <code>data1</code>.
  <code>M2</code> contains the M for <code>data2</code>.
  <code>diff</code> is the difference between <code>M2</code> and <code>M1</code>.
  The sum of the five rows following <code>diff</code> equal <code>diff</code>.</p>
<p><code>additions</code> contains the change in M induces by <code>unit</code> and <code>group</code> categories
  present in <code>data2</code> but not <code>data1</code>, and <code>removals</code> the reverse.</p>
<p>All methods return the following three terms:
  <code>unit_marginal</code> is the contribution of unit composition differences.
  <code>group_marginal</code> is the contribution of group composition differences.
  <code>structural</code> is the contribution unexplained by the marginal changes, i.e. the structural
    difference. Note that the interpretation of these terms depend on the exact method used.</p>
<p>When using "km", one additional row is returned:
   <code>interaction</code> is the contribution of differences in the joint marginal distribution
     of <code>unit</code> and <code>group</code>.</p>
<p>When "shapley_detailed" is used, an additional column "unit" is returned, along with
    six additional rows for each unit that is present in both <code>data1</code> and <code>data2</code>.
    The five rows have the following meaning:
    <code>p1</code> (<code>p2</code>) is the proportion of the unit in <code>data1</code> (<code>data2</code>)
    once non-intersecting units/groups have been removed. The changes in local linkage are
    given by <code>ls_diff1</code> and <code>ls_diff2</code>, and their average is given by
    <code>ls_diff_mean</code>. The row named <code>total</code>
    summarizes the contribution of
    the unit towards structural change
    using the formula <code>.5 * p1 * ls_diff1 + .5 * p2 * ls_diff2</code>.
    The sum of all "total" components equals structural change.</p>
<p>If <code>se</code> is set to <code>TRUE</code>, an additional column <code>se</code> contains
  the associated bootstrapped standard errors, an additional column <code>CI</code> contains
  the estimate confidence interval as a list column, an additional column <code>bias</code> contains
  the estimated bias, and the column <code>est</code> contains the bias-corrected estimates.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The Shapley method is an improvement over the Karmel-Maclachlan method (Deutsch et al. 2006).
It is based on several margins-adjusted data inputs
and yields symmetrical results (i.e. <code>data1</code> and <code>data2</code> can be switched).
When "shapley_detailed" is used, the structural component is further decomposed into
the contributions of individuals units.</p>
<p>The Karmel-Maclachlan method (Karmel and Maclachlan 1988) adjusts
the margins of <code>data1</code> to be similar to the margins of <code>data2</code>. This process
is not symmetrical.</p>
<p>The Shapley and Karmel-Maclachlan methods are based on iterative proportional fitting (IPF),
first introduced by Deming and Stephan (1940).
Depending on the size of the dataset, this may take a few seconds (see <a href='ipf.html'>ipf</a> for details).</p>
<p>The method developed by Mora and Ruiz-Castillo (2009) uses an algebraic approach to estimate the
size of the components. This will often yield substantively different results from the Shapley
and Karmel-Maclachlan methods. Note that this method is not symmetric in terms of what is
defined as <code>group</code> and <code>unit</code> categories, which may yield contradictory results.</p>
<p>A problem arises when there are <code>group</code> and/or <code>unit</code> categories in <code>data1</code>
that are not present in <code>data2</code> (or vice versa).
All methods estimate the difference only
for categories that are present in both datasets, and report additionally
the change in M that is induced by these cases as
<code>additions</code> (present in <code>data2</code>, but not in <code>data1</code>) and
<code>removals</code> (present in <code>data1</code>, but not in <code>data2</code>).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>W. E. Deming, F. F. Stephan. 1940. "On a Least Squares Adjustment of a Sampled Frequency Table
   When the Expected Marginal Totals are Known."
   The Annals of Mathematical Statistics 11(4): 427-444.</p>
<p>T. Karmel and M. Maclachlan. 1988.
  "Occupational Sex Segregation — Increasing or Decreasing?" Economic Record 64: 187-195.</p>
<p>R. Mora and J. Ruiz-Castillo. 2009. "The Invariance Properties of the
  Mutual Information Index of Multigroup Segregation." Research on Economic Inequality 17: 33-53.</p>
<p>J. Deutsch, Y. Flückiger, and J. Silber. 2009.
      "Analyzing Changes in Occupational Segregation: The Case of Switzerland (1970–2000)."
       Research on Economic Inequality 17: 171–202.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># decompose the difference in school segregation between 2000 and 2005,</span>
<span class='co'># using the Shapley method</span>
<span class='fu'>mutual_difference</span><span class='op'>(</span><span class='va'>schools00</span>, <span class='va'>schools05</span>, group <span class='op'>=</span> <span class='st'>"race"</span>, unit <span class='op'>=</span> <span class='st'>"school"</span>,
    weight <span class='op'>=</span> <span class='st'>"n"</span>, method <span class='op'>=</span> <span class='st'>"shapley"</span>, precision <span class='op'>=</span> <span class='fl'>.1</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              stat           est
#&gt; 1:             M1  4.255390e-01
#&gt; 2:             M2  4.133851e-01
#&gt; 3:           diff -1.215388e-02
#&gt; 4:      additions -3.412776e-03
#&gt; 5:       removals -1.140509e-02
#&gt; 6: group_marginal  1.722948e-02
#&gt; 7:  unit_marginal -2.347844e-13
#&gt; 8:     structural -1.456550e-02</div><div class='input'><span class='co'># =&gt; the structural component is close to zero, thus most change is in the marginals.</span>
<span class='co'># This method gives identical results when we switch the unit and group definitions,</span>
<span class='co'># and when we switch the data inputs.</span>

<span class='co'># the Karmel-Maclachlan method is similar, but only adjust the data in the forward direction...</span>
<span class='fu'>mutual_difference</span><span class='op'>(</span><span class='va'>schools00</span>, <span class='va'>schools05</span>, group <span class='op'>=</span> <span class='st'>"school"</span>, unit <span class='op'>=</span> <span class='st'>"race"</span>,
    weight <span class='op'>=</span> <span class='st'>"n"</span>, method <span class='op'>=</span> <span class='st'>"km"</span>, precision <span class='op'>=</span> <span class='fl'>.1</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              stat          est
#&gt; 1:             M1  0.425538976
#&gt; 2:             M2  0.413385092
#&gt; 3:           diff -0.012153884
#&gt; 4:      additions -0.003412776
#&gt; 5:       removals -0.011405093
#&gt; 6: group_marginal -0.020609129
#&gt; 7:  unit_marginal  0.017497722
#&gt; 8:    interaction -0.017497722
#&gt; 9:     structural  0.023273114</div><div class='input'>
<span class='co'># ...this means that the results won't be identical when we switch the data inputs</span>
<span class='fu'>mutual_difference</span><span class='op'>(</span><span class='va'>schools05</span>, <span class='va'>schools00</span>, group <span class='op'>=</span> <span class='st'>"school"</span>, unit <span class='op'>=</span> <span class='st'>"race"</span>,
    weight <span class='op'>=</span> <span class='st'>"n"</span>, method <span class='op'>=</span> <span class='st'>"km"</span>, precision <span class='op'>=</span> <span class='fl'>.1</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              stat          est
#&gt; 1:             M1  0.413385092
#&gt; 2:             M2  0.425538976
#&gt; 3:           diff  0.012153884
#&gt; 4:      additions  0.011405093
#&gt; 5:       removals  0.003412776
#&gt; 6: group_marginal  0.019784513
#&gt; 7:  unit_marginal -0.016961244
#&gt; 8:    interaction  0.016961244
#&gt; 9:     structural -0.022448498</div><div class='input'>
<span class='co'># the MRC method indicates a much higher structural change...</span>
<span class='fu'>mutual_difference</span><span class='op'>(</span><span class='va'>schools00</span>, <span class='va'>schools05</span>, group <span class='op'>=</span> <span class='st'>"race"</span>, unit <span class='op'>=</span> <span class='st'>"school"</span>,
    weight <span class='op'>=</span> <span class='st'>"n"</span>, method <span class='op'>=</span> <span class='st'>"mrc"</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              stat          est
#&gt; 1:             M1  0.425538976
#&gt; 2:             M2  0.413385092
#&gt; 3:           diff -0.012153884
#&gt; 4:      additions -0.003412776
#&gt; 5:       removals -0.011405093
#&gt; 6:  unit_marginal -0.004207757
#&gt; 7: group_marginal  0.062334448
#&gt; 8:     structural -0.055462706</div><div class='input'>
<span class='co'># ...and is not symmetric</span>
<span class='fu'>mutual_difference</span><span class='op'>(</span><span class='va'>schools00</span>, <span class='va'>schools05</span>, group <span class='op'>=</span> <span class='st'>"school"</span>, unit <span class='op'>=</span> <span class='st'>"race"</span>,
    weight <span class='op'>=</span> <span class='st'>"n"</span>, method <span class='op'>=</span> <span class='st'>"mrc"</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              stat          est
#&gt; 1:             M1  0.425538976
#&gt; 2:             M2  0.413385092
#&gt; 3:           diff -0.012153884
#&gt; 4:      additions -0.003412776
#&gt; 5:       removals -0.011405093
#&gt; 6:  unit_marginal  0.017236954
#&gt; 7: group_marginal -0.004209936
#&gt; 8:     structural -0.010363032</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Benjamin Elbers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


