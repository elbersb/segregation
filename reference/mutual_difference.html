<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Uses one of three methods to decompose the difference between two M indices:
(1) "shapley" / "shapley_detailed": a method based on the Shapley decomposition
with a few advantages over the Karmel-Maclachlan method
(recommended and the default, Deutsch et al. 2006),
(2) "km": the method based on Karmel-Maclachlan (1988),
(3) "mrc": the method developed by Mora and Ruiz-Castillo (2009).
All methods have been extended to account for missing units/groups in either data input.'><title>Decomposes the difference between two M indices — mutual_difference • segregation</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Decomposes the difference between two M indices — mutual_difference"><meta property="og:description" content='Uses one of three methods to decompose the difference between two M indices:
(1) "shapley" / "shapley_detailed": a method based on the Shapley decomposition
with a few advantages over the Karmel-Maclachlan method
(recommended and the default, Deutsch et al. 2006),
(2) "km": the method based on Karmel-Maclachlan (1988),
(3) "mrc": the method developed by Mora and Ruiz-Castillo (2009).
All methods have been extended to account for missing units/groups in either data input.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">segregation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/segregation.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
    <a class="dropdown-item" href="../articles/plotting.html">Visualizing and compressing segregation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/elbersb/segregation/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Decomposes the difference between two M indices</h1>
      <small class="dont-index">Source: <a href="https://github.com/elbersb/segregation/blob/HEAD/R/mutual_difference.R" class="external-link"><code>R/mutual_difference.R</code></a></small>
      <div class="d-none name"><code>mutual_difference.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Uses one of three methods to decompose the difference between two M indices:
(1) "shapley" / "shapley_detailed": a method based on the Shapley decomposition
with a few advantages over the Karmel-Maclachlan method
(recommended and the default, Deutsch et al. 2006),
(2) "km": the method based on Karmel-Maclachlan (1988),
(3) "mrc": the method developed by Mora and Ruiz-Castillo (2009).
All methods have been extended to account for missing units/groups in either data input.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mutual_difference</span><span class="op">(</span></span>
<span>  <span class="va">data1</span>,</span>
<span>  <span class="va">data2</span>,</span>
<span>  <span class="va">group</span>,</span>
<span>  <span class="va">unit</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"shapley"</span>,</span>
<span>  se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  n_bootstrap <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data1</dt>
<dd><p>A data frame with same structure as <code>data2</code>.</p></dd>


<dt>data2</dt>
<dd><p>A data frame with same structure as <code>data1</code>.</p></dd>


<dt>group</dt>
<dd><p>A categorical variable or a vector of variables
contained in <code>data</code>. Defines the first dimension
over which segregation is computed.</p></dd>


<dt>unit</dt>
<dd><p>A categorical variable or a vector of variables
contained in <code>data</code>. Defines the second dimension
over which segregation is computed.</p></dd>


<dt>weight</dt>
<dd><p>Numeric. (Default <code>NULL</code>)</p></dd>


<dt>method</dt>
<dd><p>Either "shapley" (the default), "km" (Karmel and Maclachlan method), or
"mrc" (Mora and Ruiz-Castillo method).</p></dd>


<dt>se</dt>
<dd><p>If <code>TRUE</code>, the segregation estimates are bootstrapped to provide
standard errors and to apply bias correction. The bias that is reported
has already been applied to the estimates (i.e. the reported estimates are "debiased")
(Default <code>FALSE</code>)</p></dd>


<dt>CI</dt>
<dd><p>If <code>se = TRUE</code>, compute the confidence (CI*100)<!-- % confidence interval -->
in addition to the bootstrap standard error.
This is based on percentiles of the bootstrap distribution, and a valid interpretation
relies on a larger number of bootstrap iterations. (Default <code>0.95</code>)</p></dd>


<dt>n_bootstrap</dt>
<dd><p>Number of bootstrap iterations. (Default <code>100</code>)</p></dd>


<dt>base</dt>
<dd><p>Base of the logarithm that is used in the calculation.
Defaults to the natural logarithm.</p></dd>


<dt>...</dt>
<dd><p>Only used for additional arguments when
when <code>method</code> is set to <code>shapley</code> or <code>km</code>. See <a href="ipf.html">ipf</a> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a data.table with columns <code>stat</code> and <code>est</code>. The data frame contains
  the following rows defined by <code>stat</code>:</p>
<p></p>
<p><code>M1</code> contains the M for <code>data1</code>.</p>
<p></p>
<p><code>M2</code> contains the M for <code>data2</code>.</p>
<p></p>
<p><code>diff</code> is the difference between <code>M2</code> and <code>M1</code>.
  The sum of the five rows following <code>diff</code> equal <code>diff</code>.</p>
<p></p>
<p><code>additions</code> contains the change in M induces by <code>unit</code> and <code>group</code> categories
  present in <code>data2</code> but not <code>data1</code>, and <code>removals</code> the reverse.</p>


<p>All methods return the following three terms:</p>
<p></p>
<p><code>unit_marginal</code> is the contribution of unit composition differences.</p>
<p></p>
<p><code>group_marginal</code> is the contribution of group composition differences.</p>
<p></p>
<p><code>structural</code> is the contribution unexplained by the marginal changes, i.e. the structural
    difference. Note that the interpretation of these terms depend on the exact method used.</p>


<p>When using "km", one additional row is returned:</p>
<p></p>
<p><code>interaction</code> is the contribution of differences in the joint marginal distribution
     of <code>unit</code> and <code>group</code>.</p>


<p>When "shapley_detailed" is used, an additional column "unit" is returned, along with
    six additional rows for each unit that is present in both <code>data1</code> and <code>data2</code>.
    The five rows have the following meaning:</p>
<p></p>
<p><code>p1</code> (<code>p2</code>) is the proportion of the unit in <code>data1</code> (<code>data2</code>)
    once non-intersecting units/groups have been removed. The changes in local linkage are
    given by <code>ls_diff1</code> and <code>ls_diff2</code>, and their average is given by</p>
<p></p>
<p><code>ls_diff_mean</code>. The row named <code>total</code></p>


<p>summarizes the contribution of
    the unit towards structural change
    using the formula <code>.5 * p1 * ls_diff1 + .5 * p2 * ls_diff2</code>.
    The sum of all "total" components equals structural change.</p>


<p>If <code>se</code> is set to <code>TRUE</code>, an additional column <code>se</code> contains
  the associated bootstrapped standard errors, an additional column <code>CI</code> contains
  the estimate confidence interval as a list column, an additional column <code>bias</code> contains
  the estimated bias, and the column <code>est</code> contains the bias-corrected estimates.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Shapley method is an improvement over the Karmel-Maclachlan method (Deutsch et al. 2006).
It is based on several margins-adjusted data inputs
and yields symmetrical results (i.e. <code>data1</code> and <code>data2</code> can be switched).
When "shapley_detailed" is used, the structural component is further decomposed into
the contributions of individuals units.</p>
<p>The Karmel-Maclachlan method (Karmel and Maclachlan 1988) adjusts
the margins of <code>data1</code> to be similar to the margins of <code>data2</code>. This process
is not symmetrical.</p>
<p>The Shapley and Karmel-Maclachlan methods are based on iterative proportional fitting (IPF),
first introduced by Deming and Stephan (1940).
Depending on the size of the dataset, this may take a few seconds (see <a href="ipf.html">ipf</a> for details).</p>
<p>The method developed by Mora and Ruiz-Castillo (2009) uses an algebraic approach to estimate the
size of the components. This will often yield substantively different results from the Shapley
and Karmel-Maclachlan methods. Note that this method is not symmetric in terms of what is
defined as <code>group</code> and <code>unit</code> categories, which may yield contradictory results.</p>
<p>A problem arises when there are <code>group</code> and/or <code>unit</code> categories in <code>data1</code>
that are not present in <code>data2</code> (or vice versa).
All methods estimate the difference only
for categories that are present in both datasets, and report additionally
the change in M that is induced by these cases as
<code>additions</code> (present in <code>data2</code>, but not in <code>data1</code>) and
<code>removals</code> (present in <code>data1</code>, but not in <code>data2</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>W. E. Deming, F. F. Stephan. 1940. "On a Least Squares Adjustment of a Sampled Frequency Table
   When the Expected Marginal Totals are Known."
   The Annals of Mathematical Statistics 11(4): 427-444.</p>
<p>T. Karmel and M. Maclachlan. 1988.
  "Occupational Sex Segregation — Increasing or Decreasing?" Economic Record 64: 187-195.</p>
<p>R. Mora and J. Ruiz-Castillo. 2009. "The Invariance Properties of the
  Mutual Information Index of Multigroup Segregation." Research on Economic Inequality 17: 33-53.</p>
<p>J. Deutsch, Y. Flückiger, and J. Silber. 2009.
      "Analyzing Changes in Occupational Segregation: The Case of Switzerland (1970–2000)."
       Research on Economic Inequality 17: 171–202.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># decompose the difference in school segregation between 2000 and 2005,</span></span></span>
<span class="r-in"><span><span class="co"># using the Shapley method</span></span></span>
<span class="r-in"><span><span class="fu">mutual_difference</span><span class="op">(</span><span class="va">schools00</span>, <span class="va">schools05</span>,</span></span>
<span class="r-in"><span>    group <span class="op">=</span> <span class="st">"race"</span>, unit <span class="op">=</span> <span class="st">"school"</span>,</span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="st">"n"</span>, method <span class="op">=</span> <span class="st">"shapley"</span>, precision <span class="op">=</span> <span class="fl">.1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># =&gt; the structural component is close to zero, thus most change is in the marginals.</span></span></span>
<span class="r-in"><span><span class="co"># This method gives identical results when we switch the unit and group definitions,</span></span></span>
<span class="r-in"><span><span class="co"># and when we switch the data inputs.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the Karmel-Maclachlan method is similar, but only adjust the data in the forward direction...</span></span></span>
<span class="r-in"><span><span class="fu">mutual_difference</span><span class="op">(</span><span class="va">schools00</span>, <span class="va">schools05</span>,</span></span>
<span class="r-in"><span>    group <span class="op">=</span> <span class="st">"school"</span>, unit <span class="op">=</span> <span class="st">"race"</span>,</span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="st">"n"</span>, method <span class="op">=</span> <span class="st">"km"</span>, precision <span class="op">=</span> <span class="fl">.1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ...this means that the results won't be identical when we switch the data inputs</span></span></span>
<span class="r-in"><span><span class="fu">mutual_difference</span><span class="op">(</span><span class="va">schools05</span>, <span class="va">schools00</span>,</span></span>
<span class="r-in"><span>    group <span class="op">=</span> <span class="st">"school"</span>, unit <span class="op">=</span> <span class="st">"race"</span>,</span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="st">"n"</span>, method <span class="op">=</span> <span class="st">"km"</span>, precision <span class="op">=</span> <span class="fl">.1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the MRC method indicates a much higher structural change...</span></span></span>
<span class="r-in"><span><span class="fu">mutual_difference</span><span class="op">(</span><span class="va">schools00</span>, <span class="va">schools05</span>,</span></span>
<span class="r-in"><span>    group <span class="op">=</span> <span class="st">"race"</span>, unit <span class="op">=</span> <span class="st">"school"</span>,</span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="st">"n"</span>, method <span class="op">=</span> <span class="st">"mrc"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ...and is not symmetric</span></span></span>
<span class="r-in"><span><span class="fu">mutual_difference</span><span class="op">(</span><span class="va">schools00</span>, <span class="va">schools05</span>,</span></span>
<span class="r-in"><span>    group <span class="op">=</span> <span class="st">"school"</span>, unit <span class="op">=</span> <span class="st">"race"</span>,</span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="st">"n"</span>, method <span class="op">=</span> <span class="st">"mrc"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://elbersb.com" class="external-link">Benjamin Elbers</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

