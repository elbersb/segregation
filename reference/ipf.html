<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adjustment of marginal distributions using iterative proportional fitting — ipf • segregation</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adjustment of marginal distributions using iterative proportional fitting — ipf"><meta name="description" content="Adjusts the marginal distributions for group and unit
in source to the respective marginal distributions in target, using the iterative
proportional fitting algorithm (IPF)."><meta property="og:description" content="Adjusts the marginal distributions for group and unit
in source to the respective marginal distributions in target, using the iterative
proportional fitting algorithm (IPF)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">segregation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/segregation.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">Visualizing and compressing segregation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/elbersb/segregation/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adjustment of marginal distributions using iterative proportional fitting</h1>
      <small class="dont-index">Source: <a href="https://github.com/elbersb/segregation/blob/master/R/ipf.R" class="external-link"><code>R/ipf.R</code></a></small>
      <div class="d-none name"><code>ipf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Adjusts the marginal distributions for <code>group</code> and <code>unit</code>
in <code>source</code> to the respective marginal distributions in <code>target</code>, using the iterative
proportional fitting algorithm (IPF).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ipf</span><span class="op">(</span></span>
<span>  <span class="va">source</span>,</span>
<span>  <span class="va">target</span>,</span>
<span>  <span class="va">group</span>,</span>
<span>  <span class="va">unit</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iterations <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">1e-07</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-source">source<a class="anchor" aria-label="anchor" href="#arg-source"></a></dt>
<dd><p>A "source" data frame. The marginals of this
dataset are adjusted to the marginals of <code>target</code>.</p></dd>


<dt id="arg-target">target<a class="anchor" aria-label="anchor" href="#arg-target"></a></dt>
<dd><p>A "target" data frame. The function returns a dataset
where the marginal distributions of <code>group</code> and <code>unit</code> categories
are approximated by those of <code>target</code>.</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>A categorical variable or a vector of variables
contained in <code>source</code> and <code>target</code>. Defines the first distribution
for adjustment.</p></dd>


<dt id="arg-unit">unit<a class="anchor" aria-label="anchor" href="#arg-unit"></a></dt>
<dd><p>A categorical variable or a vector of variables
contained in <code>source</code> and <code>target</code>. Defines the second distribution
for adjustment.</p></dd>


<dt id="arg-weight">weight<a class="anchor" aria-label="anchor" href="#arg-weight"></a></dt>
<dd><p>Numeric. (Default <code>NULL</code>)</p></dd>


<dt id="arg-max-iterations">max_iterations<a class="anchor" aria-label="anchor" href="#arg-max-iterations"></a></dt>
<dd><p>Maximum number of iterations used for the IPF algorithm.</p></dd>


<dt id="arg-precision">precision<a class="anchor" aria-label="anchor" href="#arg-precision"></a></dt>
<dd><p>Convergence criterion for the IPF algorithm. In every iteration,
the ratio of the source and target marginals are calculated for every category of
<code>group</code> and <code>unit</code>. The algorithm converges when all ratios are smaller
than <code>1 + precision</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a data frame that retains
  the association structure of <code>source</code> while approximating
  the marginal distributions for <code>group</code> and <code>unit</code> of <code>target</code>.
  The dataset identifies each combination of <code>group</code> and <code>unit</code>,
  and categories that only occur in either <code>source</code> or <code>target</code> are dropped.
  The adjusted frequency of each combination is given by the column <code>n</code>,
  while <code>n_target</code> and <code>n_source</code> contain the zero-adjusted frequencies
  in the target and source dataset, respectively.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The algorithm works by scaling
the marginal distribution of <code>group</code> in the <code>source</code> data frame towards the
marginal distribution of <code>target</code>; then repeating this process for <code>unit</code>. The
algorithm then keeps alternating between <code>group</code> and <code>unit</code> until the marginals
of the adjusted data frame are within the allowed precision. This results in a dataset that
retains the association structure of <code>source</code> while approximating
the marginal distribution of <code>target</code>. If the number of <code>unit</code> and
<code>group</code> categories is different in <code>source</code> and <code>target</code>, the data frame returns
the combination of <code>unit</code> and <code>group</code> categories that occur in both datasets.
Zero values are replaced by a small, non-zero number (1e-4).
Note that the values returned sum to the observations of the source data frame, not the
target data frame. This is different from other IPF implementations, but ensures that the IPF
does not change the number of observations.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>W. E. Deming and F. F. Stephan. 1940.
  "On a Least Squares Adjustment of a Sampled Frequency Table
  When the Expected Marginal Totals are Known".
  Annals of Mathematical Statistics. 11 (4): 427–444.</p>
<p>T. Karmel and M. Maclachlan. 1988.
  "Occupational Sex Segregation — Increasing or Decreasing?" Economic Record 64: 187-195.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># adjusts the marginals of group and unit categories so that</span></span></span>
<span class="r-in"><span><span class="co"># schools00 has similar marginals as schools05</span></span></span>
<span class="r-in"><span><span class="va">adj</span> <span class="op">&lt;-</span> <span class="fu">ipf</span><span class="op">(</span><span class="va">schools00</span>, <span class="va">schools05</span>, <span class="st">"race"</span>, <span class="st">"school"</span>, weight <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check that the new "race" marginals are similar to the target marginals</span></span></span>
<span class="r-in"><span><span class="co"># (the same could be done for schools)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">adj</span><span class="op">$</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">adj</span><span class="op">$</span><span class="va">race</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">adj</span><span class="op">$</span><span class="va">n_target</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">adj</span><span class="op">$</span><span class="va">race</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note that the adjusted dataset contains fewer</span></span></span>
<span class="r-in"><span><span class="co"># schools than either the source or the target dataset,</span></span></span>
<span class="r-in"><span><span class="co"># because the marginals are only defined for the overlap</span></span></span>
<span class="r-in"><span><span class="co"># of schools</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">schools00</span><span class="op">$</span><span class="va">school</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">schools05</span><span class="op">$</span><span class="va">school</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">adj</span><span class="op">$</span><span class="va">school</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://elbersb.com" class="external-link">Benjamin Elbers</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

